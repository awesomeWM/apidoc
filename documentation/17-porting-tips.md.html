<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
   "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <title>Topic 17-porting-tips.md - awesome API documentation</title>
    <link rel="stylesheet" href="../ldoc.css" type="text/css" />
   <script>
     function show_extra(id) {
        var cur = document.getElementById("item"+id).className

        if (cur == "hide_extra") {
            document.getElementById("item"+id).className = "show_more"
            document.getElementById("button"+id).className = "hide_extra"
        }
     }
   </script>

</head>
<body>

<div id="container">
<div id="main">





<!-- Menu -->

<div id="navigation">
<h1>awesome</h1>

<ul>
  <li><a href="../index.html">Index</a></li>
</ul>

<h2>Contents</h2>
<ul>
<li><a href="#From_3_5_to_4_0">From 3.5 to 4.0 </a></li>
</ul>


<h2>Documentation</h2>
<ul class="nowrap">
  <li><a href="../documentation/00-authors.md.html">Authors</a></li>
  <li><a href="../documentation/01-readme.md.html">Readme</a></li>
  <li><a href="../documentation/02-contributing.md.html">Contributing</a></li>
  <li><a href="../documentation/03-declarative-layout.md.html">The Widget system</a></li>
  <li><a href="../documentation/04-new-widgets.md.html">Creating new widget</a></li>
  <li><a href="../documentation/05-awesomerc.md.html">Default configuration file documentation</a></li>
  <li><a href="../documentation/06-appearance.md.html">Change Awesome appearance</a></li>
  <li><a href="../documentation/07-my-first-awesome.md.html">My first Awesome</a></li>
  <li><a href="../documentation/08-client-layout-system.md.html">The AwesomeWM client layout system</a></li>
  <li><a href="../documentation/09-options.md.html">Startup options</a></li>
  <li><a href="../documentation/10-building-and-testing.md.html">Building and Testing</a></li>
  <li><a href="../documentation/16-using-cairo.md.html">Using Cairo and LGI</a></li>
  <li><strong>Tips for upgrading your configuration</strong></li>
  <li><a href="../documentation/89-NEWS.md.html">NEWS</a></li>
  <li><a href="../documentation/90-FAQ.md.html">FAQ</a></li>
</ul>
<h2>Core components</h2>
<ul class="nowrap">
  <li><a href="../core_components/awesome.html">awesome</a></li>
  <li><a href="../core_components/awful.keygrabber.html">awful.keygrabber</a></li>
  <li><a href="../core_components/client.html">client<span class='listplusign'> and awful.client</span></a></li>
  <li><a href="../core_components/drawable.html">drawable</a></li>
  <li><a href="../core_components/gears.timer.html">gears.timer</a></li>
  <li><a href="../core_components/mousegrabber.html">mousegrabber</a></li>
  <li><a href="../core_components/naughty.action.html">naughty.action</a></li>
  <li><a href="../core_components/naughty.notification.html">naughty.notification</a></li>
  <li><a href="../core_components/root.html">root</a></li>
  <li><a href="../core_components/screen.html">screen<span class='listplusign'> and awful.screen</span></a></li>
  <li><a href="../core_components/tag.html">tag<span class='listplusign'> and awful.tag</span></a></li>
</ul>
<h2>Input handling</h2>
<ul class="nowrap">
  <li><a href="../input_handling/awful.button.html">awful.button</a></li>
  <li><a href="../input_handling/awful.key.html">awful.key</a></li>
  <li><a href="../input_handling/awful.keyboard.html">awful.keyboard</a></li>
  <li><a href="../input_handling/mouse.html">mouse</a></li>
</ul>
<h2>Declarative rules</h2>
<ul class="nowrap">
  <li><a href="../declarative_rules/ruled.client.html">ruled.client</a></li>
  <li><a href="../declarative_rules/ruled.notifications.html">ruled.notifications</a></li>
</ul>
<h2>Widgets</h2>
<ul class="nowrap">
  <li><a href="../widgets/awful.widget.button.html">awful.widget.button</a></li>
  <li><a href="../widgets/awful.widget.clienticon.html">awful.widget.clienticon</a></li>
  <li><a href="../widgets/awful.widget.keyboardlayout.html">awful.widget.keyboardlayout</a></li>
  <li><a href="../widgets/awful.widget.launcher.html">awful.widget.launcher</a></li>
  <li><a href="../widgets/awful.widget.layoutbox.html">awful.widget.layoutbox</a></li>
  <li><a href="../widgets/awful.widget.layoutlist.html">awful.widget.layoutlist</a></li>
  <li><a href="../widgets/awful.widget.prompt.html">awful.widget.prompt</a></li>
  <li><a href="../widgets/awful.widget.taglist.html">awful.widget.taglist</a></li>
  <li><a href="../widgets/awful.widget.tasklist.html">awful.widget.tasklist</a></li>
  <li><a href="../widgets/awful.widget.watch.html">awful.widget.watch</a></li>
  <li><a href="../widgets/naughty.list.actions.html">naughty.list.actions</a></li>
  <li><a href="../widgets/naughty.list.notifications.html">naughty.list.notifications</a></li>
  <li><a href="../widgets/naughty.widget.icon.html">naughty.widget.icon</a></li>
  <li><a href="../widgets/naughty.widget.message.html">naughty.widget.message</a></li>
  <li><a href="../widgets/naughty.widget.title.html">naughty.widget.title</a></li>
  <li><a href="../widgets/wibox.widget.calendar.html">wibox.widget.calendar</a></li>
  <li><a href="../widgets/wibox.widget.checkbox.html">wibox.widget.checkbox</a></li>
  <li><a href="../widgets/wibox.widget.graph.html">wibox.widget.graph</a></li>
  <li><a href="../widgets/wibox.widget.imagebox.html">wibox.widget.imagebox</a></li>
  <li><a href="../widgets/wibox.widget.piechart.html">wibox.widget.piechart</a></li>
  <li><a href="../widgets/wibox.widget.progressbar.html">wibox.widget.progressbar</a></li>
  <li><a href="../widgets/wibox.widget.separator.html">wibox.widget.separator</a></li>
  <li><a href="../widgets/wibox.widget.slider.html">wibox.widget.slider</a></li>
  <li><a href="../widgets/wibox.widget.systray.html">wibox.widget.systray</a></li>
  <li><a href="../widgets/wibox.widget.textbox.html">wibox.widget.textbox</a></li>
  <li><a href="../widgets/wibox.widget.textclock.html">wibox.widget.textclock</a></li>
</ul>
<h2>Widget containers</h2>
<ul class="nowrap">
  <li><a href="../widget_containers/awful.widget.only_on_screen.html">awful.widget.only_on_screen</a></li>
  <li><a href="../widget_containers/naughty.widget.background.html">naughty.widget.background</a></li>
  <li><a href="../widget_containers/wibox.container.arcchart.html">wibox.container.arcchart</a></li>
  <li><a href="../widget_containers/wibox.container.background.html">wibox.container.background</a></li>
  <li><a href="../widget_containers/wibox.container.constraint.html">wibox.container.constraint</a></li>
  <li><a href="../widget_containers/wibox.container.margin.html">wibox.container.margin</a></li>
  <li><a href="../widget_containers/wibox.container.mirror.html">wibox.container.mirror</a></li>
  <li><a href="../widget_containers/wibox.container.place.html">wibox.container.place</a></li>
  <li><a href="../widget_containers/wibox.container.radialprogressbar.html">wibox.container.radialprogressbar</a></li>
  <li><a href="../widget_containers/wibox.container.rotate.html">wibox.container.rotate</a></li>
  <li><a href="../widget_containers/wibox.container.scroll.html">wibox.container.scroll</a></li>
  <li><a href="../widget_containers/wibox.container.tile.html">wibox.container.tile</a></li>
</ul>
<h2>Widget layouts</h2>
<ul class="nowrap">
  <li><a href="../widget_layouts/wibox.layout.align.html">wibox.layout.align</a></li>
  <li><a href="../widget_layouts/wibox.layout.fixed.html">wibox.layout.fixed</a></li>
  <li><a href="../widget_layouts/wibox.layout.flex.html">wibox.layout.flex</a></li>
  <li><a href="../widget_layouts/wibox.layout.grid.html">wibox.layout.grid</a></li>
  <li><a href="../widget_layouts/wibox.layout.manual.html">wibox.layout.manual</a></li>
  <li><a href="../widget_layouts/wibox.layout.ratio.html">wibox.layout.ratio</a></li>
  <li><a href="../widget_layouts/wibox.layout.stack.html">wibox.layout.stack</a></li>
</ul>
<h2>Popups and bars</h2>
<ul class="nowrap">
  <li><a href="../popups_and_bars/awful.hotkeys_popup.widget.html">awful.hotkeys_popup.widget</a></li>
  <li><a href="../popups_and_bars/awful.menu.html">awful.menu</a></li>
  <li><a href="../popups_and_bars/awful.popup.html">awful.popup</a></li>
  <li><a href="../popups_and_bars/awful.titlebar.html">awful.titlebar</a></li>
  <li><a href="../popups_and_bars/awful.tooltip.html">awful.tooltip</a></li>
  <li><a href="../popups_and_bars/awful.wallpaper.html">awful.wallpaper</a></li>
  <li><a href="../popups_and_bars/awful.wibar.html">awful.wibar</a></li>
  <li><a href="../popups_and_bars/awful.widget.calendar_popup.html">awful.widget.calendar_popup</a></li>
  <li><a href="../popups_and_bars/menubar.html">menubar</a></li>
  <li><a href="../popups_and_bars/naughty.layout.box.html">naughty.layout.box</a></li>
  <li><a href="../popups_and_bars/naughty.layout.legacy.html">naughty.layout.legacy</a></li>
  <li><a href="../popups_and_bars/wibox.html">wibox</a></li>
</ul>
<h2>Utility libraries</h2>
<ul class="nowrap">
  <li><a href="../utility_libraries/gears.debug.html">gears.debug</a></li>
  <li><a href="../utility_libraries/gears.filesystem.html">gears.filesystem</a></li>
  <li><a href="../utility_libraries/gears.geometry.html">gears.geometry</a></li>
  <li><a href="../utility_libraries/gears.math.html">gears.math</a></li>
  <li><a href="../utility_libraries/gears.object.html">gears.object</a></li>
  <li><a href="../utility_libraries/gears.protected_call.html">gears.protected_call</a></li>
  <li><a href="../utility_libraries/gears.sort.html">gears.sort</a></li>
  <li><a href="../utility_libraries/gears.string.html">gears.string</a></li>
  <li><a href="../utility_libraries/gears.table.html">gears.table</a></li>
  <li><a href="../utility_libraries/gears.wallpaper.html">gears.wallpaper</a></li>
</ul>
<h2>Theme related libraries</h2>
<ul class="nowrap">
  <li><a href="../theme_related_libraries/beautiful.html">beautiful</a></li>
  <li><a href="../theme_related_libraries/gears.color.html">gears.color</a></li>
  <li><a href="../theme_related_libraries/gears.shape.html">gears.shape</a></li>
</ul>
<h2>Libraries</h2>
<ul class="nowrap">
  <li><a href="../libraries/awful.completion.html">awful.completion</a></li>
  <li><a href="../libraries/awful.hotkeys_popup.html">awful.hotkeys_popup</a></li>
  <li><a href="../libraries/awful.layout.html">awful.layout</a></li>
  <li><a href="../libraries/awful.permissions.html">awful.permissions</a></li>
  <li><a href="../libraries/awful.placement.html">awful.placement</a></li>
  <li><a href="../libraries/awful.prompt.html">awful.prompt</a></li>
  <li><a href="../libraries/awful.rules.html">awful.rules</a></li>
  <li><a href="../libraries/awful.spawn.html">awful.spawn</a></li>
  <li><a href="../libraries/awful.util.html">awful.util</a></li>
  <li><a href="../libraries/dbus.html">dbus</a></li>
  <li><a href="../libraries/gears.matcher.html">gears.matcher</a></li>
  <li><a href="../libraries/gears.surface.html">gears.surface</a></li>
  <li><a href="../libraries/menubar.menu_gen.html">menubar.menu_gen</a></li>
  <li><a href="../libraries/menubar.utils.html">menubar.utils</a></li>
  <li><a href="../libraries/naughty.html">naughty</a></li>
  <li><a href="../libraries/selection.html">selection</a></li>
  <li><a href="../libraries/wibox.widget.html">wibox.widget</a></li>
</ul>
<h2>Sample files</h2>
<ul class="nowrap">
  <li><a href="../sample files/rc.lua.html">rc.lua</a></li>
  <li><a href="../sample files/theme.lua.html">theme.lua</a></li>
</ul>
<h2>Classes</h2>
<ul class="nowrap">
  <li><a href="../classes/awful.widget.common.html">awful.widget.common</a></li>
  <li><a href="../classes/gears.cache.html">gears.cache</a></li>
  <li><a href="../classes/gears.matrix.html">gears.matrix</a></li>
  <li><a href="../classes/menubar.icon_theme.html">menubar.icon_theme</a></li>
  <li><a href="../classes/menubar.index_theme.html">menubar.index_theme</a></li>
  <li><a href="../classes/wibox.hierarchy.html">wibox.hierarchy</a></li>
  <li><a href="../classes/wibox.widget.base.html">wibox.widget.base</a></li>
  <li><a href="../classes/xproperties.html">xproperties</a></li>
</ul>

</div>

<div id="content">

    # Tips for upgrading your configuration
<p><a name="v4"></a>
## From 3.5 to 4.0
<p>The
**best advice is to start from the default <a href="../sample files/rc.lua.html#">rc.lua</a> and backport any changes**
you might have added to your <a href="../sample files/rc.lua.html#">rc.lua</a>.
This avoids most of the possible errors due to missing important changes.
<p>To do this, you can download the default rc.lua for 3.5.9
[here](https://github.com/awesomeWM/awesome/blob/v3.5.9/awesomerc.lua.in), and
then compare your existing rc.lua with the 3.5.9 default using your diff tool of
choice. Write down the changes, then apply these to the 4.0 default rc.lua,
which you can find at /etc/xdg/awesome/rc.lua after the upgrade, or
[here](../sample%20files/rc.lua.html) if you have not yet performed the upgrade.
<p>If you still wish to ignore this advice, first read the
<a href="89-NEWS.md.html#v4">NEWS</a> section about the breaking changes. This
document assumes you did.
<p>Be warned, even if it looks like it's working after changing some lines, **it wont
supports dynamic screen changes and will have many subtle bugs**. The changes
mentioned below **are important for the stability of your window manager**.
<p>Here is a diff of the 3.5.9 <a href="../sample files/rc.lua.html#">rc.lua</a> with the 4.0 one. All changes due to
new features and new syntaxes have been removed. A <code>-</code> in front of the line
correspond to content of the 3.5 <a href="../sample files/rc.lua.html#">rc.lua</a> and <code>+</code> its replacement in 4.0.
<p>This document does not cover the new features added in the Awesome v4 <a href="../sample files/rc.lua.html#">rc.lua</a>,
it only covers the minimal required changes to have a properly behaving config.
<p>To test during the port, we recommend the <code>Xephyr</code> X11 server.
<p>If Awesome v4 **is not installed yet**, we recommend to install it in its own
prefix to avoid conflicts in case you wish to stay on 3.5 for a little
longer:
<p>    cd path/to/awesome/code
    mkdir -p $HOME/.config/awesome4
    mkdir build -p
    cd build
<p>    # Install in a local folder, this assumes all the dependencies are installed
    cmake -DCMAKE_INSTALL_PREFIX=$HOME/awesome4_test ..
    make -j4
<p>    # Use a copy of rc.lua to avoid it being overwritten accidentally
    cp awesomerc.lua $HOME/.config/awesome4/rc.lua
<p>    make install
<p>    # Start Awesome in a 1280x800 window
    Xephyr :1 -screen 1280x800 &
    DISPLAY=:1 $HOME/awesome4_test/bin/awesome \
        -c $HOME/.config/awesome4/rc.lua \
        --search $HOME/awesome4_test/share/awesome/lib
<p>If Awesome v4 is **already installed**, then backup your old <a href="../sample files/rc.lua.html#">rc.lua</a> and overwrite
<code>~/.config/awesome/rc.lua</code> (replace this by another path if you use a custom
XDH config local directory). And only execute:
<p>    Xephyr :1 -screen 1280x800 &
    DISPLAY=:1 awesome
<p>Screens are now added and removed without reloading <a href="../sample files/rc.lua.html#">rc.lua</a>. The wallpaper are
now set in a signal callback.
<p>    --- {{{ Wallpaper
    -if <a href="../theme_related_libraries/beautiful.html#beautiful.wallpaper">beautiful.wallpaper</a> then
    -    for s = 1, screen.count() do
    -        <a href="../utility_libraries/gears.wallpaper.html#maximized">gears.wallpaper.maximized</a>(beautiful.wallpaper, s, true)
    -    end
    -end
    --- }}}
<p>    +local function set_wallpaper(s)
    +    -- Wallpaper
    +    if <a href="../theme_related_libraries/beautiful.html#beautiful.wallpaper">beautiful.wallpaper</a> then
    +        local wallpaper = <a href="../theme_related_libraries/beautiful.html#beautiful.wallpaper">beautiful.wallpaper</a>
    +        -- If wallpaper is a function, call it with the screen
    +        if type(wallpaper) == "function" then
    +            wallpaper = wallpaper(s)
    +        end
    +        <a href="../utility_libraries/gears.wallpaper.html#maximized">gears.wallpaper.maximized</a>(wallpaper, s, true)
    +    end
    +end
    +
    +-- Re-set wallpaper when a screen's geometry changes (e.g. different resolution)
    +<a href="../core_components/screen.html#connect_signal">screen.connect_signal</a>("property::geometry", set_wallpaper)
<p>Tags need to be created for each screens, the old static initialization cannot
work. Remove this section.
<p>    --- {{{ Tags
    --- Define a tag table which hold all screen tags.
    -tags = {}
    -for s = 1, <a href="../core_components/screen.html#count">screen.count</a>() do
    -    -- Each screen has its own tag table.
    -    tags[s] = awful.tag({ 1, 2, 3, 4, 5, 6, 7, 8, 9 }, s, layouts[1])
    - end
    --- }}}
<p>The <code>quit</code> menu command must be wrapped in a function, otherwise an error
occurs due to mismatched argument types from the v4 <a href="../popups_and_bars/awful.menu.html#">awful.menu</a> library.
<p>     -- {{{ Menu
     -- Create a laucher widget and a main menu
     myawesomemenu = {
       { "manual", terminal .. " -e man awesome" },
       { "edit config", editor_cmd .. " " .. awesome.conffile },
       { "restart", awesome.restart },
    -  { "quit", awesome.quit }
    +  { "quit", function() awesome.quit() end}
     }
<p>The textclock is now part of the <a href="../popups_and_bars/wibox.html#">wibox</a> library, rename it.
<p>     -- {{{ Wibar
     -- Create a textclock widget
    -mytextclock = <code>awful.widget.textclock</code>()
    +mytextclock = <a href="../widgets/wibox.widget.textclock.html#">wibox.widget.textclock</a>()
<p>
Widgets were previously added to static global tables. This isn't going to
behave correctly when screen are added and removed. Remove this section.
<p>     --- Create a wibox for each screen and add it
     -mywibox = {}
     -mypromptbox = {}
     -mylayoutbox = {}
     -mytaglist = {}
     -mytasklist = {}
<p>Many functions have been converted to methods. The old functions are deprecated,
they are still supported, but will be removed in the next release.
<p>    -mytaglist.buttons = awful.util.table.join(
    +local taglist_buttons = awful.util.table.join(
    -                    awful.button({ }, 1, <code>awful.tag.viewonly</code>),
    +                    awful.button({ }, 1, function(t) t:<code>view_only</code>() end),
    -                    awful.button({ modkey }, 1, <code>awful.client.movetotag</code>),
    +                    awful.button({ modkey }, 1, function(t)
    +                                              if <a href="../core_components/client.html#focus">client.focus</a> then
    +                                                  <code>client.focus:move_to_tag</code>(t)
    +                                              end
    +                                          end),
                         <a href="../input_handling/awful.button.html#">awful.button</a>({ }, 3, <code>awful.tag.viewtoggle</code>),
    -                    <a href="../input_handling/awful.button.html#">awful.button</a>({ modkey }, 3, <code>awful.client.toggletag</code>),
    +                    <a href="../input_handling/awful.button.html#">awful.button</a>({ modkey }, 3, function(t)
    +                                              if client.focus then
    +                                                  client.focus:toggle_tag(t)
    +                                              end
    +                                          end),
    -                    <a href="../input_handling/awful.button.html#">awful.button</a>({ }, 4, function(t) <code>awful.tag.viewnext</code>(awful.tag.getscreen(t)) end),
    -                    <a href="../input_handling/awful.button.html#">awful.button</a>({ }, 5, function(t) <code>awful.tag.viewprev</code>(awful.tag.getscreen(t)) end)
    +                    <a href="../input_handling/awful.button.html#">awful.button</a>({ }, 4, function(t) <code>awful.tag.viewnext</code>(t.screen) end),
    +                    <a href="../input_handling/awful.button.html#">awful.button</a>({ }, 5, function(t) <code>awful.tag.viewprev</code>(t.screen) end)
                         )
<p>    -mytasklist.buttons = awful.util.table.join(
    +local tasklist_buttons = awful.util.table.join(
                          awful.button({ }, 1, function (c)
                                                   if c == <a href="../core_components/client.html#focus">client.focus</a> then
                                                       c.minimized = true
                                                   else
                                                       -- Without this, the following
                                                       -- :isvisible() makes no sense
                                                       c.minimized = false
    -                                                  if not c:isvisible() then
    -                                                      <code>awful.tag.viewonly</code>(c:tags()[1])
    +                                                  if not c:isvisible() and c.<code>first_tag</code> then
    +                                                      c.first_tag:view_only()
                                                       end
                                                       -- This will also un-minimize
                                                       -- the client, if needed
                                                       <a href="../core_components/client.html#focus">client.focus</a> = c
                                                       c:raise()
                                                   end
                                               end),
<p>
This section is **very important**. This is where adding and removing screens is
handled (including during startup). Note that the <code>mysomething</code> table
previously removed are replaced by custom screens attributes.
<p>    -for s = 1, <a href="../core_components/screen.html#count">screen.count</a>() do
    +<code>awful.screen.connect_for_each_screen</code>(function(s)
    +    -- Wallpaper
    +    set_wallpaper(s)
    +
    +    -- Each screen has its own tag table.
    +    awful.tag({ "1", "2", "3", "4", "5", "6", "7", "8", "9" }, s, awful.layout.layouts[1])
    +
         -- Create a promptbox for each screen
    -    mypromptbox[s] = <a href="../widgets/awful.widget.prompt.html#">awful.widget.prompt</a>()
    +    s.mypromptbox = <a href="../widgets/awful.widget.prompt.html#">awful.widget.prompt</a>()
         -- Create an imagebox widget which will contains an icon indicating which layout we're using.
         -- We need one layoutbox per screen.
    -    mylayoutbox[s] = <a href="../widgets/awful.widget.layoutbox.html#">awful.widget.layoutbox</a>(s)
    +    s.mylayoutbox = <a href="../widgets/awful.widget.layoutbox.html#">awful.widget.layoutbox</a>(s)
    -    mylayoutbox[s]:buttons(<code>awful.util.table.join</code>(
    +    s.mylayoutbox:buttons(<code>awful.util.table.join</code>(
                                <a href="../input_handling/awful.button.html#">awful.button</a>({ }, 1, function () <a href="../libraries/awful.layout.html#awful.layout.inc">awful.layout.inc</a>( 1) end),
                                <a href="../input_handling/awful.button.html#">awful.button</a>({ }, 3, function () <a href="../libraries/awful.layout.html#awful.layout.inc">awful.layout.inc</a>(-1) end),
                                <a href="../input_handling/awful.button.html#">awful.button</a>({ }, 4, function () <a href="../libraries/awful.layout.html#awful.layout.inc">awful.layout.inc</a>( 1) end),
                                <a href="../input_handling/awful.button.html#">awful.button</a>({ }, 5, function () <a href="../libraries/awful.layout.html#awful.layout.inc">awful.layout.inc</a>(-1) end)))
         -- Create a taglist widget
    -    mytaglist[s] = <a href="../widgets/awful.widget.taglist.html#">awful.widget.taglist</a>(s, <code>awful.widget.taglist.filter.all</code>, mytaglist.buttons)
    +    s.mytaglist = <a href="../widgets/awful.widget.taglist.html#">awful.widget.taglist</a>(s, <code>awful.widget.taglist.filter.all</code>, taglist_buttons)
<p>         -- Create a tasklist widget
    -    mytasklist[s] = <a href="../widgets/awful.widget.tasklist.html#">awful.widget.tasklist</a>(s, <code>awful.widget.tasklist.filter.currenttags</code>, mytasklist.buttons)
    +    s.mytasklist = <a href="../widgets/awful.widget.tasklist.html#">awful.widget.tasklist</a>(s, <code>awful.widget.tasklist.filter.currenttags</code>, tasklist_buttons)
<p>         -- Create the wibox
    -    mywibox[s] = <code>awful.wibox</code>({ position = "top", screen = s })
    +    s.mywibox = <a href="../popups_and_bars/awful.wibar.html#">awful.wibar</a>({ position = "top", screen = s })
<p>         -- Widgets that are aligned to the left
         local left_layout = wibox.layout.fixed.horizontal()
    -    left_layout:add(mylauncher)
    -    left_layout:add(mytaglist[s])
    -    left_layout:add(mypromptbox[s])
    +    left_layout:add(s.mytaglist)
    +    left_layout:add(s.mypromptbox)
<p>        -- Widgets that are aligned to the right
         local right_layout = wibox.layout.fixed.horizontal()
    -    if s == 1 then right_layout:add(wibox.widget.systray()) end
    +    right_layout:add(wibox.widget.systray())
         right_layout:add(mytextclock)
    -    right_layout:add(mylayoutbox[s])
    +    right_layout:add(s.mylayoutbox)
<p>         -- Now bring it all together (with the tasklist in the middle)
         local layout = wibox.layout.align.horizontal()
         layout:set_left(left_layout)
    -    layout:set_middle(mytasklist[s])
    +    layout:set_middle(s.mytasklist)
         layout:set_right(right_layout)
<p>    -    mywibox[s]:set_widget(layout)
    +    s.mywibox:set_widget(layout)
    end)
     -- }}}
<p>
<code>awful.util.spawn</code> is now called <a href="../libraries/awful.spawn.html#">awful.spawn</a>.
<p>    -- Standard program
    -    <a href="../input_handling/awful.key.html#">awful.key</a>({ modkey,           }, "Return", function () <code>awful.util.spawn</code>(terminal) end),
    +    <a href="../input_handling/awful.key.html#">awful.key</a>({ modkey,           }, "Return", function () <a href="../libraries/awful.spawn.html#">awful.spawn</a>(terminal) end),
<p>Another dynamic screen related changes.
<p>    ⠀-- Prompt
    -    awful.key({ modkey },            "r",     function () mypromptbox[mouse.screen]:run() end),
    +    awful.key({ modkey },            "r",     function () <code>awful.screen.focused</code>().mypromptbox:run() end),
<p><a href="../libraries/awful.prompt.html#">awful.prompt</a> now uses a more future-proof arguments table instead of many
optional arguments.
<p>    ⠀    awful.key({ modkey }, "x",
                   function ()
    -                  <a href="../libraries/awful.prompt.html#awful.prompt.run">awful.prompt.run</a>({ prompt = "Run Lua code: " },
    -                  mypromptbox[mouse.screen].widget,
    -                  <a href="../libraries/awful.util.html#awful.util.eval">awful.util.eval</a>, nil,
    -                  <a href="../libraries/awful.util.html#getdir">awful.util.getdir</a>("cache") .. "/history_eval")
    -              end),
    +                  awful.prompt.run {
    +                    prompt       = "Run Lua code: ",
    +                    textbox      = <code>awful.screen.focused</code>().mypromptbox.widget,
    +                    exe_callback = <a href="../libraries/awful.util.html#awful.util.eval">awful.util.eval</a>,
    +                    history_path = <a href="../libraries/awful.util.html#get_cache_dir">awful.util.get_cache_dir</a>() .. "/history_eval"
    +                  }
    +              end),
<p>
Another function-to-method API change:
<p>    -    <a href="../input_handling/awful.key.html#">awful.key</a>({ modkey,           }, "o",      <code>awful.client.movetoscreen</code>                        ),
    +    <a href="../input_handling/awful.key.html#">awful.key</a>({ modkey,           }, "o",      function (c) c:<code>move_to_screen</code>()               end),
<p>The <code>mod4+[1-9]</code> keybindings also have some changes related to deprecated
functions.
<p>    -- Bind all key numbers to tags.
    -- Be careful: we use keycodes to make it works on any keyboard layout.
    -- This should map on the top row of your keyboard, usually 1 to 9.
    for i = 1, 9 do
              -- View tag only.
              awful.key({ modkey }, "#" .. i + 9,
                        function ()
     -                        local screen = <a href="../input_handling/mouse.html#screen">mouse.screen</a>
     -                        local tag = <code>awful.tag.gettags</code>(screen)[i]
     +                        local screen = <code>awful.screen.focused</code>()
     +                        local tag = <a href="../core_components/screen.html#tags">screen.tags</a>[i]
                              if tag then
     -                           <code>awful.tag.viewonly</code>(tag)
     +                           <a href="../core_components/tag.html#view_only">tag:view_only</a>()
                              end
                        end),
     -        -- Toggle tag.
     +        -- Toggle tag display.
              awful.key({ modkey, "Control" }, "#" .. i + 9,
                        function ()
     -                      local screen = <a href="../input_handling/mouse.html#screen">mouse.screen</a>
     -                      local tag = <code>awful.tag.gettags</code>(screen)[i]
     +                      local screen = <code>awful.screen.focused</code>()
     +                      local tag = <a href="../core_components/screen.html#tags">screen.tags</a>[i]
                            if tag then
                               <code>awful.tag.viewtoggle</code>(tag)
                            end
     for i = 1, 9 do
              awful.key({ modkey, "Shift" }, "#" .. i + 9,
                        function ()
                            if client.focus then
     -                          local tag = <code>awful.tag.gettags</code>(client.focus.screen)[i]
     +                          local tag = <code>client.focus.screen.tags</code>[i]
                                if tag then
     -                              <code>awful.client.movetotag</code>(tag)
     +                              <code>client.focus:move_to_tag</code>(tag)
                                end
                           end
                        end),
     -        -- Toggle tag.
     +        -- Toggle tag on focused client.
              awful.key({ modkey, "Control", "Shift" }, "#" .. i + 9,
                        function ()
                            if client.focus then
     -                          local tag = <code>awful.tag.gettags</code>(client.focus.screen)[i]
     +                          local tag = <code>client.focus.screen.tags</code>[i]
                                if tag then
     -                              <code>awful.client.toggletag</code>(tag)
     +                              <code>client.focus:toggle_tag</code>(tag)
                                end
                            end
     -                  end))
     +                  end),
     +    )
    end
<p>The default rules need to be changed to avoid having offscreen clients:
<p>     awful.rules.rules = {
         -- All clients will match this rule.
         { rule = { },
           properties = { border_width = beautiful.border_width,
               awful.rules.rules = {
                          focus = awful.client.focus.filter,
                          raise = true,
                          keys = clientkeys,
     +                     buttons = clientbuttons,
     +                     screen = <code>awful.screen.preferred</code>,
     +                     placement = <a href="../libraries/awful.placement.html#awful.placement.no_overlap">awful.placement.no_overlap</a>+<a href="../libraries/awful.placement.html#awful.placement.no_offscreen">awful.placement.no_offscreen</a>
<p>The <code>tags</code> global table has been removed to support dynamic screens, you can
now access tags by name.
<p>    -    --   properties = { tag = tags[1][2] } },
    +    --   properties = { screen = 1, tag = "2" } },
<p>If you need to get the current client object in global context, currently you can use
<a href="../core_components/client.html#focus">client.focus</a> for it. E.g., to mark/unmark the client:
<p>    -    awful.client.mark()
    +    client.focus.marked = true
<p>    -    awful.client.unmark()
    +    client.focus.marked = false


</div> <!-- id="content" -->
</div> <!-- id="main" -->
<div id="about">
<i>generated by <a href="http://github.com/stevedonovan/LDoc">LDoc 1.4.6</a></i>
</div> <!-- id="about" -->
</div> <!-- id="container" -->

<script defer type="text/javascript">
    const $nav = document.querySelector("#navigation");

    // When clicking the sidebar, open it
    $nav.addEventListener("click", function(ev) {
        if (document.body.clientWidth >= 768) {
            return;
        }

        const target = $nav;
        if (!target.classList.contains("open")) {
            target.classList.add("open");
            ev.stopPropagation();
        }
    });

    // When clicking anywhere else than the sidebar, close it
    document.querySelector("body").addEventListener("click", function(ev) {
        if (document.body.clientWidth >= 768 || ev.target.contains($nav)) {
            return;
        }

        const target = $nav;
        if (target.classList.contains("open")) {
            target.classList.remove("open");
        }
    });

    const copyResultClasses = {
        success : "copy-link--success",
        failure: "copy-link--failure"
    };

    const removeCopyResultClasses = ($target) =>
        Object.values(copyResultClasses).forEach(c => $target.classList.remove(c));

    document.querySelectorAll(".js-copy-link").forEach(copyLink => {
        copyLink.addEventListener("click", function(e) {
            e.preventDefault();
            const $target = e.target;

            removeCopyResultClasses($target);

            let link = $target.href;
            if (!link) {
                return;
            }
            if (link.startsWith("#")) {
                const curr = window.location.pathname;
                link = curr.substring(0, curr.indexOf("#")) + link;
            }

            // We need to create a fake element to copy the text from
            const fakeElement = document.createElement("textarea");
            fakeElement.value = link;
            document.body.appendChild(fakeElement);
            fakeElement.select();

            let success = false;
            try {
                success = document.execCommand("copy");
            } catch(err) {
                success = false;
            }

            fakeElement.remove();
            $target.classList.add(success ? copyResultClasses.success : copyResultClasses.failure);
            setInterval(() => removeCopyResultClasses($target), 1500);
        });
    });
</script>

</body>
</html>
